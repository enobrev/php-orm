<?php
    namespace {{ namespace }};
{% if date_updated  %}

    use DateTime;
{% endif %}

    use Enobrev\ORM\Db;
    use Enobrev\ORM\Tables;
    use Enobrev\SQL;

    class {{table.plural}} extends Tables {
        /**
         * @return {{table.plural}}
         */
        public static function get() {
            $oTable = new {{table.title}}();
            $oSQL = SQL::select($oTable);

            $oResults = Db::getInstance()->namedQuery('{{table.plural}}.get', $oSQL);
            return self::fromResults($oResults, $oTable);
        }
{% if date_updated  %}

        /**
         * @return DateTime
         * @throws \Enobrev\ORM\DbException
         * @throws \Enobrev\SQLMissingTableOrFieldsException
         */
        public static function getMostRecentUpdatedDate() {
            $oTable = new {{table.title}}();
            $oSQL = SQL::select(
                $oTable->{{ date_updated.name }},
                SQL::desc($oTable->{{ date_updated.name }}),
                SQL::limit(1)
            );

            $oResults = Db::getInstance()->namedQuery([__CLASS__, __METHOD__], $oSQL);
            return new DateTime($oResults->fetch_object()->{{ date_updated.name }});
        }
{% endif %}
{% if date_added %}

        /**
         * @return DateTime
         * @throws \Enobrev\ORM\DbException
         * @throws \Enobrev\SQLMissingTableOrFieldsException
         */
        public static function getMostRecentAddedDate() {
            $oTable = new {{table.title}}();
            $oSQL = SQL::select(
                $oTable->{{ date_added.name }},
                SQL::desc($oTable->{{ date_added.name }}),
                SQL::limit(1)
            );

            $oResults = Db::getInstance()->namedQuery([__CLASS__, __METHOD__], $oSQL);
            return new DateTime($oResults->fetch_object()->{{ date_added.name }});
        }
{% endif %}
    }