<?php
    namespace {{ namespace }};
{% if date_updated or date_added  %}

    use DateTime;
{% endif %}

    use Enobrev\ORM\Db;
    use Enobrev\ORM\Tables;
    use Enobrev\SQL;

    class {{table.plural}} extends Tables {
        /**
         * @return {{table.plural}}
         */
        public static function get() {
            $oTable = new {{table.title}}();
            $oSQL = SQL::select($oTable);

            $oResults = Db::getInstance()->namedQuery([__CLASS__, __METHOD__], $oSQL);
            return self::fromResults($oResults, $oTable);
        }
{% if count.outbound %}
{% for field in fields %}
{% if field.reference %}

        /**
         * @param int|{{field.reference.title}} $i{{field.reference.title}}Id
         * @return {{table.plural}}
         * @throws \Enobrev\ORM\DbException
         * @throws \Enobrev\SQLMissingTableOrFieldsException
         */
        public static function getBy{{field.reference.title}}($i{{field.reference.title}}Id) {
            $oTable = new {{table.title}}();
            $oSQL = SQL::select(
                $oTable,
                SQL::eq($oTable->{{field.reference.name_singular}}_id->setValue($i{{field.reference.title}}Id))
            );

            $oResults = Db::getInstance()->namedQuery([__CLASS__, __METHOD__], $oSQL);
            return self::fromResults($oResults, $oTable);
        }

        /**
         * @param {field.reference.title_plural}}|int[] $a{{field.reference.title}}Ids
         * @return {{table.plural}}
         * @throws \Enobrev\ORM\DbException
         * @throws \Enobrev\SQLMissingTableOrFieldsException
         */
        public static function getBy{{field.reference.title_plural}}($a{{field.reference.title}}Ids) {
            if ($a{{field.reference.title}}s instanceof [{field.reference.title_plural}}) {
                $a{{field.reference.title}}s = $a{{field.reference.title}}s->toPrimaryArray();
            }

            $oTable = new {{table.title}}();
            $oSQL = SQL::select(
                $oTable,
                SQL::in($oTable->{{field.reference.name_singular}}_id, $a{{field.reference.title}}Ids)
            );

            $oResults = Db::getInstance()->namedQuery([__CLASS__, __METHOD__], $oSQL);
            return self::fromResults($oResults, $oTable);
        }
{% endif %}
{% endfor %}
{% endif %}

{% if date_updated or date_added  %}

        /**
         * @return DateTime
         * @throws \Enobrev\ORM\DbException
         * @throws \Enobrev\SQLMissingTableOrFieldsException
         */
{% if date_updated %}
        public static function getMostRecentUpdatedDate() {
{% else %}
        public static function getMostRecentAddedDate() {
{% endif %}
            $oTable = new {{table.title}}();
            $oSQL = SQL::select(
{% if date_updated %}
                $oTable->{{ date_updated.name }},
                SQL::desc($oTable->{{ date_updated.name }}),
{% else %}
                $oTable->{{ date_added.name }},
                SQL::desc($oTable->{{ date_added.name }}),
{% endif %}
                SQL::limit(1)
            );

            $oResults = Db::getInstance()->namedQuery([__CLASS__, __METHOD__], $oSQL);
{% if date_updated %}
            return new DateTime($oResults->fetch_object()->{{ date_updated.name }});
{% else %}
            return new DateTime($oResults->fetch_object()->{{ date_added.name }});
{% endif %}
        }
{% endif %}
    }